<view class="translator-container paper-cut-bg">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="top-nav">
    <view class="nav-item" bindtap="showHistory">
      <text class="nav-icon">ğŸ“œ</text>
      <text class="nav-text">å†å²</text>
    </view>
    <view class="nav-item" bindtap="showFavorites">
      <text class="nav-icon">â­</text>
      <text class="nav-text">æ”¶è—</text>
    </view>
  </view>

  <!-- å†å²è®°å½•å¼¹çª— -->
  <view wx:if="{{showHistory}}" class="modal-overlay" bindtap="hideHistory">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">ç¿»è¯‘å†å²</text>
        <text class="modal-close" bindtap="hideHistory">å…³é—­</text>
      </view>
      <scroll-view scroll-y class="modal-body">
        <view wx:if="{{translationHistory.length > 0}}">
          <view
            wx:for="{{translationHistory}}"
            wx:key="id"
            class="history-item"
            bindtap="selectHistoryItem"
            data-phrase="{{item.phrase}}"
          >
            <view class="history-phrase">{{item.phrase}}</view>
            <view class="history-time">{{item.timeText}}</view>
          </view>
        </view>
        <view wx:else class="empty-state">
          <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
        </view>
      </scroll-view>
      <view wx:if="{{translationHistory.length > 0}}" class="modal-footer">
        <text class="clear-btn" bindtap="clearHistory">æ¸…ç©ºå†å²</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—å¼¹çª— -->
  <view wx:if="{{showFavorites}}" class="modal-overlay" bindtap="hideFavorites">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">æˆ‘çš„æ”¶è—</text>
        <text class="modal-close" bindtap="hideFavorites">å…³é—­</text>
      </view>
      <scroll-view scroll-y class="modal-body">
        <view wx:if="{{favorites.length > 0}}">
          <view
            wx:for="{{favorites}}"
            wx:key="id"
            class="favorite-item"
            bindtap="selectFavoriteItem"
            data-phrase="{{item.traditional}}"
          >
            <view class="favorite-phrase">{{item.traditional}}</view>
            <view class="favorite-modern">{{item.modern}}</view>
          </view>
        </view>
        <view wx:else class="empty-state">
          <text class="empty-text">æš‚æ— æ”¶è—</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content">
    <view class="card">
      <view class="card-title">
        <text class="icon">ğŸ“</text>
        çº¢åŒ…ç¥ç¦è¯­ç¿»è¯‘
      </view>

      <view class="form-group">
        <view class="form-label">è¾“å…¥ç¥ç¦è¯­</view>
        <textarea
          class="form-input"
          placeholder="è¯·è¾“å…¥ä¼ ç»Ÿç¥ç¦è¯­ï¼Œä¾‹å¦‚ï¼šæ­å–œå‘è´¢"
          value="{{inputText}}"
          bindinput="onInputText"
          maxlength="50"
          auto-height
        />
      </view>

      <button
        class="btn btn-primary"
        bindtap="translateText"
        disabled="{{!inputText || inputText.length === 0}}"
      >
        å¼€å§‹ç¿»è¯‘
      </button>

      <view wx:if="{{translation}}" class="result-card">
        <view class="result-header">
          <view class="result-title">ç¿»è¯‘ç»“æœ</view>
          <text class="favorite-btn {{translation.isFavorite ? 'active' : ''}}" bindtap="toggleFavorite">
            {{translation.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}
          </text>
        </view>
        <view class="form-group">
          <view class="form-label">ä¼ ç»Ÿè¡¨è¾¾</view>
          <view class="result-value">{{translation.traditional}}</view>
        </view>
        <view class="form-group">
          <view class="form-label">ç°ä»£ç¿»è¯‘</view>
          <view class="result-value">{{translation.modern}}</view>
        </view>
        <view class="form-group">
          <view class="form-label">å«ä¹‰è§£æ</view>
          <view class="result-value">{{translation.meaning}}</view>
        </view>
        <view wx:if="{{translation.usage}}" class="form-group">
          <view class="form-label">é€‚ç”¨åœºæ™¯</view>
          <view class="result-value">{{translation.usage}}</view>
        </view>

        <button
          class="btn btn-secondary"
          bindtap="copyTranslation"
        >
          å¤åˆ¶å®Œæ•´ç»“æœ
        </button>
      </view>
      
      <view class="form-group">
        <view class="form-label">ç¥ç¦è¯­åº“</view>
        <view class="category-grid">
          <view 
            wx:for="{{categoryList}}" 
            wx:key="index"
            class="category-btn {{selectedCategory === item ? 'active' : ''}}"
            bindtap="selectCategory" 
            data-category="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-label">æ¨èç¥ç¦è¯­</view>
        <view wx:if="{{filteredPhrases.length > 0}}">
          <view 
            wx:for="{{filteredPhrases}}" 
            wx:key="id"
            class="phrase-card"
            bindtap="selectPhrase"
            data-phrase="{{item.traditional}}"
          >
            <view class="phrase-header">
              <text class="phrase-text">{{item.traditional}}</text>
            </view>
            <view class="phrase-preview">
              <text class="preview-label">ç°ä»£ç‰ˆï¼š</text>
              <text class="preview-text">{{item.modern}}</text>
            </view>
          </view>
        </view>
        <view wx:if="{{filteredPhrases.length === 0}}" class="empty-state">
          <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç¥ç¦è¯­</text>
          <text class="empty-tip">è¯·é€‰æ‹©å…¶ä»–åˆ†ç±»æˆ–ç›´æ¥åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç”¨æˆ·åé¦ˆç»„ä»¶ -->
  <feedback pageName="translator" />
</view>