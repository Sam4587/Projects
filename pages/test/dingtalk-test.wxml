<!-- pages/test/dingtalk-test.wxml -->
<view class="container">
  <view class="header">
    <text class="title">钉钉反馈机制测试</text>
    <text class="subtitle">验证钉钉机器人是否能正确接收用户反馈</text>
  </view>

  <!-- 状态显示 -->
  <view class="status-section">
    <view class="status-card {{currentStatus}}">
      <text class="status-title">测试状态</text>
      <text class="status-message">{{statusMessage || '准备开始测试'}}</text>
      
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{testProgress}}%"></view>
      </view>
      <text class="progress-text">{{testProgress}}%</text>
    </view>
  </view>

  <!-- 测试报告 -->
  <view class="report-section" wx:if="{{testReport}}">
    <view class="report-card">
      <text class="report-title">测试报告</text>
      <view class="report-stats">
        <view class="stat-item">
          <text class="stat-value">{{testReport.successCount}}/{{testReport.totalCount}}</text>
          <text class="stat-label">通过/总数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{testReport.successRate}}%</text>
          <text class="stat-label">成功率</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{testReport.timestamp}}</text>
          <text class="stat-label">测试时间</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 测试结果列表 -->
  <view class="results-section">
    <text class="section-title">测试结果详情</text>
    
    <view class="results-list">
      <view class="result-item {{item.success ? 'success' : 'failed'}}" 
            wx:for="{{testResults}}" wx:key="index">
        <view class="result-icon">
          <text>{{item.success ? '✅' : '❌'}}</text>
        </view>
        <view class="result-content">
          <text class="result-name">{{item.name}}</text>
          <text class="result-message">{{item.result}}</text>
          <text class="result-time">{{item.timestamp}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="actions-section">
    <button class="btn btn-primary" bindtap="runFullTest" disabled="{{currentStatus === 'testing'}}">
      {{currentStatus === 'testing' ? '测试中...' : '运行完整测试'}}
    </button>
    
    <view class="btn-group">
      <button class="btn btn-secondary" bindtap="testConnectivity">
        测试连通性
      </button>
      <button class="btn btn-secondary" bindtap="testMessageFormat">
        测试消息格式
      </button>
      <button class="btn btn-secondary" bindtap="simulateUserFeedback">
        模拟用户反馈
      </button>
      <button class="btn btn-secondary" bindtap="checkServiceStatus">
        查看服务状态
      </button>
    </view>
    
    <button class="btn btn-clear" bindtap="clearResults">
      清空结果
    </button>
  </view>

  <!-- 测试说明 -->
  <view class="instructions">
    <text class="instructions-title">测试说明</text>
    <view class="instruction-item">
      <text class="bullet">•</text>
      <text class="instruction-text">运行测试后，请检查钉钉群聊是否收到测试消息</text>
    </view>
    <view class="instruction-item">
      <text class="bullet">•</text>
      <text class="instruction-text">验证消息格式、内容、字段是否完整正确</text>
    </view>
    <view class="instruction-item">
      <text class="bullet">•</text>
      <text class="instruction-text">测试降级机制：断开网络后提交反馈</text>
    </view>
  </view>
</view>