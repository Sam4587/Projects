# 随礼那点事儿 - 项目文档

## 项目概述

**项目名称**: 随礼那点事儿（原：红包装潢助手）
**项目类型**: 微信小程序 - 纯前端版本
**当前版本**: v1.0.0
**技术栈**: 微信小程序原生开发 + ES6 + WXML/WXSS

## 核心功能

### 1. 随礼计算器
- 支持关系类型（家人亲戚、朋友同学、同事领导、老板客户）
- 支持亲疏程度（点头之交、普通关系、关系密切、非常要好）
- 支持场合选择（生日、婚礼、葬礼、春节、毕业、乔迁、满月、一般场合）
- 支持地域习俗（34个省份/直辖市/自治区/特别行政区）
- 支持预算范围设置
- 智能推荐金额计算
- 动态吉利数字推荐（与推荐金额和预算范围相关联）

### 2. 红包翻译器
- 传统祝福语转现代白话翻译
- 祝福语分类管理（14个分类）
- 搜索功能（支持精确匹配和模糊搜索）
- 收藏功能（最多50条）
- 历史记录功能（最多100条）
- 复制功能

### 3. 地域习俗库
- 34个地区完整风俗数据
- 吉利数字推荐
- 传统习俗说明
- 地域特点介绍

### 4. 用户反馈系统
- 本地存储反馈数据
- 钉钉消息推送集成
- 反馈内容管理

## 项目结构

```
/
├── pages/                    # 页面文件
│   ├── calculator/            # 随礼计算器
│   ├── translator/            # 红包翻译器
│   ├── customs/               # 地域习俗
│   ├── stats/                 # 数据统计
│   └── index/                 # 首页
├── components/               # 公共组件
│   └── feedback/            # 用户反馈组件
├── config/                  # 配置文件
│   ├── blessings/            # 祝福语数据
│   └── customs/             # 地域习俗数据
├── utils/                   # 工具函数
│   ├── regional-rule-system.js    # 地域规则系统
│   ├── smart-recommendation-engine.js  # 智能推荐引擎
│   ├── ad-config.js             # 广告配置
│   └── dingtalk-feedback.js      # 钉钉反馈服务
├── assets/                  # 静态资源
├── cloudbase-functions/    # 云函数（备用）
├── docs/                   # 项目文档
└── scripts/                # 脚本工具
```

## 已完成的优化任务

### 2026-02-06
- ✅ 优化吉利数字推荐功能，支持根据推荐金额和预算范围动态生成
- ✅ 优化红包翻译页面祝福语选择提示文本显示，解决文本截断问题

## 上线前待办任务

### 高优先级（必须完成）
1. **添加API超时设置和重试机制**
   - 为钉钉API调用添加3-5秒超时
   - 实现指数退避重试策略
   - 确保API调用的稳定性

2. **移除硬编码的access_token**
   - 使用环境变量或配置文件管理敏感信息
   - 提高API调用的安全性

3. **统一使用安全存储函数**
   - 修改所有直接使用localStorage的代码
   - 统一使用safeGetItem/safeSetItem函数
   - 提高本地存储操作的安全性

4. **添加缓存过期策略**
   - 扩展storage.js，添加过期时间支持
   - 实现带过期时间的存储函数
   - 确保缓存数据的时效性

### 中优先级（建议完成）
1. **集中管理静态数据**
   - 创建集中管理的静态数据文件
   - 将祝福语数据和繁简转换映射从组件中分离
   - 提高代码的可维护性

2. **实现统一的错误处理机制**
   - 创建错误处理工具函数
   - 实现错误边界组件
   - 提供统一的错误日志记录

3. **添加TypeScript类型定义**
   - 为核心数据结构添加类型定义
   - 逐步提高代码的类型安全性
   - 减少运行时错误

4. **优化降级方案**
   - 增强降级到本地存储后的用户体验
   - 实现网络恢复后的自动同步
   - 提高应用在网络不稳定情况下的可用性

5. **确保缓存数据与主数据一致性**
   - 添加数据版本检查
   - 实现缓存数据验证
   - 提供缓存刷新机制

## 后续迭代规划

### v1.1.0 - 云开发版本
- 添加云开发支持
- 实现数据同步功能
- 添加用户账户系统

### v1.2.0 - AI智能翻译
- 集成AI翻译功能
- 支持更多方言翻译
- 优化翻译准确度

### v1.3.0 - 更多地域方言
- 添加更多地区方言支持
- 完善地域习俗数据
- 增强吉利数字推荐

### v2.0.0 - 全栈应用
- 重构为全栈应用
- 支持用户账户系统
- 添加社交功能
- 支持分享和讨论

## 开发规范

### Git提交信息规范
```
<类型>(<范围>): <主题>

<正文>

<页脚>
```

**类型**：
- `feat`：新功能
- `fix`：Bug修复
- `docs`：文档更新
- `style`：代码格式调整
- `refactor`：重构
- `test`：测试相关
- `chore`：构建过程或辅助工具的变动

### 代码质量要求
1. 使用ES6+语法
2. 启用严格模式
3. 避免全局变量污染
4. 所有异步操作必须有错误处理
5. 关键函数需要参数验证
6. 空值检查（防御性编程）
7. 避免频繁的setData操作
8. 合理使用数据缓存
9. 组件按需加载

## 维护记录

- 2026-02-06: 创建项目文档，整理任务计划
- 随礼那点事儿项目组持续维护更新
