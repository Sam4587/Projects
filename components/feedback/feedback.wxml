<!-- ç”¨æˆ·åé¦ˆå¼¹çª—ç»„ä»¶ -->
<view class="feedback-modal {{show ? 'show' : ''}}" catch:touchmove="preventTouchMove">
  <view class="feedback-mask" catch:tap="closeModal"></view>
  <view class="feedback-content">
    <!-- è£…é¥°å…ƒç´  -->
    <view class="decoration-cloud cloud-left">â˜</view>
    <view class="decoration-cloud cloud-right">â˜</view>
    <view class="decoration-coin coin-1">ğŸ’°</view>
    <view class="decoration-coin coin-2">ğŸ’°</view>
    
    <!-- æ ‡é¢˜ -->
    <view class="feedback-header">
      <view class="header-icon">ğŸ’Œ</view>
      <text class="feedback-title">æ„è§åé¦ˆ</text>
      <view class="header-decoration"></view>
    </view>
    
    <!-- è¯„åˆ† -->
    <view class="feedback-section">
      <text class="section-label">æ‚¨çš„è¯„ä»·</text>
      <view class="star-rating">
        <view 
          wx:for="{{5}}" 
          wx:key="index"
          class="star {{rating > index ? 'active' : ''}}"
          data-index="{{index + 1}}"
          catch:tap="onRatingChange"
        >
          {{rating > index ? 'â˜…' : 'â˜†'}}
        </view>
      </view>
    </view>
    
    <!-- åé¦ˆç±»å‹ -->
    <view class="feedback-section">
      <text class="section-label">åé¦ˆç±»å‹</text>
      <view class="type-list">
        <view 
          wx:for="{{feedbackTypes}}" 
          wx:key="value"
          class="type-tag {{selectedType === item.value ? 'active' : ''}}"
          data-type="{{item.value}}"
          catch:tap="onTypeChange"
        >
          {{item.label}}
        </view>
      </view>
    </view>
    
    <!-- åé¦ˆå†…å®¹ -->
    <view class="feedback-section">
      <text class="section-label">æ‚¨çš„å»ºè®®</text>
      <textarea 
        class="feedback-textarea"
        placeholder="è¯·è¾“å…¥æ‚¨çš„å®è´µæ„è§ï¼Œå¸®åŠ©æˆ‘ä»¬åšå¾—æ›´å¥½..."
        value="{{content}}"
        bind:input="onContentInput"
        maxlength="500"
        show-count
      />
      <text class="char-count">{{content.length}}/500</text>
    </view>
    
    <!-- è”ç³»æ–¹å¼ -->
    <view class="feedback-section">
      <text class="section-label">è”ç³»æ–¹å¼ï¼ˆé€‰å¡«ï¼‰</text>
      <input 
        class="feedback-input"
        placeholder="å¾®ä¿¡/æ‰‹æœºå·ï¼Œæ–¹ä¾¿æˆ‘ä»¬å›å¤æ‚¨"
        value="{{contact}}"
        bind:input="onContactInput"
      />
    </view>
    
    <!-- æäº¤çŠ¶æ€å’Œé”™è¯¯æç¤º -->
    <view wx:if="{{submitStatus === 'error'}}" class="error-section">
      <view class="error-icon">âš ï¸</view>
      <text class="error-message">{{submitError}}</text>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="feedback-actions">
      <view class="btn btn-secondary" catch:tap="closeModal">
        {{submitStatus === 'error' ? 'å…³é—­' : 'å–æ¶ˆ'}}
      </view>
      <view wx:if="{{submitStatus !== 'error'}}" 
            class="btn btn-primary {{submitStatus === 'submitting' ? 'disabled' : ''}}" 
            catch:tap="submitFeedback">
        {{submitStatus === 'submitting' ? 'æäº¤ä¸­...' : 'æäº¤åé¦ˆ'}}
      </view>
      <view wx:if="{{submitStatus === 'error'}}" 
            class="btn btn-primary" 
            catch:tap="retrySubmit">
        é‡è¯•æäº¤
      </view>
    </view>

    <!-- æäº¤è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <view wx:if="{{submitStatus === 'submitting'}}" class="submit-progress">
      <view class="progress-bar">
        <view class="progress-fill"></view>
      </view>
      <text class="progress-text">æ­£åœ¨å¤„ç†æ‚¨çš„åé¦ˆ...</text>
    </view>
    
    <!-- å…³é—­æŒ‰é’® -->
    <view class="close-btn" catch:tap="closeModal">Ã—</view>
  </view>
</view>

<!-- æµ®åŠ¨åé¦ˆæŒ‰é’® -->
<view 
  class="feedback-float-btn {{dragging ? 'dragging' : ''}}"
  style="left: {{btnPosition.x}}px; top: {{btnPosition.y}}px;"
  bind:touchstart="onTouchStart"
  bind:touchmove="onTouchMove"
  bind:touchend="onTouchEnd"
  bind:tap="openModal"
>
  <view class="btn-inner">
    <text class="btn-icon">ğŸ’¬</text>
    <text class="btn-text">åé¦ˆ</text>
  </view>
  <view class="btn-glow"></view>
</view>