<view class="customs-container paper-cut-bg">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-title">åœ°åŸŸä¹ ä¿—</view>
    <view class="header-subtitle">äº†è§£å„åœ°çº¢åŒ…æ–‡åŒ–</view>
    <view class="compare-btn" bindtap="openCompare">
      <text class="compare-icon">âš–</text>
      <text class="compare-text">åœ°åŒºå¯¹æ¯”</text>
    </view>
  </view>

  <!-- åœ°åŒºå¯¹æ¯”å¼¹çª— -->
  <view wx:if="{{showCompare}}" class="modal-overlay" bindtap="closeCompare">
    <view class="modal-content compare-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">åœ°åŒºå¯¹æ¯”</text>
        <text class="modal-close" bindtap="closeCompare">å…³é—­</text>
      </view>
      <scroll-view scroll-y class="modal-body">
        <view class="compare-regions">
          <view class="compare-region-select">
            <view class="compare-label">é€‰æ‹©åœ°åŒº1</view>
            <picker
              mode="selector"
              range="{{regions}}"
              range-key="name"
              value="{{compareRegion1Index}}"
              bindchange="onCompareRegion1Change"
            >
              <view class="compare-picker">
                {{regions[compareRegion1Index].name || 'è¯·é€‰æ‹©'}}
              </view>
            </picker>
          </view>
          <view class="compare-region-select">
            <view class="compare-label">é€‰æ‹©åœ°åŒº2</view>
            <picker
              mode="selector"
              range="{{regions}}"
              range-key="name"
              value="{{compareRegion2Index}}"
              bindchange="onCompareRegion2Change"
            >
              <view class="compare-picker">
                {{regions[compareRegion2Index].name || 'è¯·é€‰æ‹©'}}
              </view>
            </picker>
          </view>
        </view>

        <view wx:if="{{compareData}}" class="compare-result">
          <view class="compare-section">
            <view class="compare-section-title">å‹å²é’±ä¹ ä¿—</view>
            <view class="compare-table">
              <view class="compare-row compare-row-header">
                <view class="compare-cell compare-cell-region">é¡¹ç›®</view>
                <view class="compare-cell">{{regions[compareRegion1Index].name}}</view>
                <view class="compare-cell">{{regions[compareRegion2Index].name}}</view>
              </view>
              <view class="compare-row">
                <view class="compare-cell compare-cell-label">é‡‘é¢åŒºé—´</view>
                <view class="compare-cell">{{compareData.region1.giftMoney.amount}}</view>
                <view class="compare-cell">{{compareData.region2.giftMoney.amount}}</view>
              </view>
              <view class="compare-row">
                <view class="compare-cell compare-cell-label">è´´å¿ƒæç¤º</view>
                <view class="compare-cell">{{compareData.region1.giftMoney.tips}}</view>
                <view class="compare-cell">{{compareData.region2.giftMoney.tips}}</view>
              </view>
            </view>
          </view>

          <view class="compare-section">
            <view class="compare-section-title">éšä»½å­ä¹ ä¿—</view>
            <view class="compare-table">
              <view class="compare-row compare-row-header">
                <view class="compare-cell compare-cell-region">é¡¹ç›®</view>
                <view class="compare-cell">{{regions[compareRegion1Index].name}}</view>
                <view class="compare-cell">{{regions[compareRegion2Index].name}}</view>
              </view>
              <view class="compare-row">
                <view class="compare-cell compare-cell-label">æ™®é€šåŒäº‹</view>
                <view class="compare-cell">{{compareData.region1.giving.colleague}}</view>
                <view class="compare-cell">{{compareData.region2.giving.colleague}}</view>
              </view>
              <view class="compare-row">
                <view class="compare-cell compare-cell-label">å¥½æœ‹å‹</view>
                <view class="compare-cell">{{compareData.region1.giving.friend}}</view>
                <view class="compare-cell">{{compareData.region2.giving.friend}}</view>
              </view>
              <view class="compare-row">
                <view class="compare-cell compare-cell-label">è´´å¿ƒæç¤º</view>
                <view class="compare-cell">{{compareData.region1.giving.tips}}</view>
                <view class="compare-cell">{{compareData.region2.giving.tips}}</view>
              </view>
            </view>
          </view>

          <view class="compare-section">
            <view class="compare-section-title">æ–‡åŒ–ç‰¹è‰²</view>
            <view class="compare-table">
              <view class="compare-row compare-row-header">
                <view class="compare-cell compare-cell-region">é¡¹ç›®</view>
                <view class="compare-cell">{{regions[compareRegion1Index].name}}</view>
                <view class="compare-cell">{{regions[compareRegion2Index].name}}</view>
              </view>
              <view class="compare-row">
                <view class="compare-cell compare-cell-label">é£æ ¼ç‰¹ç‚¹</view>
                <view class="compare-cell">{{compareData.region1.features.tone || 'æš‚æ— '}}</view>
                <view class="compare-cell">{{compareData.region2.features.tone || 'æš‚æ— '}}</view>
              </view>
              <view class="compare-row">
                <view class="compare-cell compare-cell-label">å‰åˆ©æ•°å­—</view>
                <view class="compare-cell">{{compareData.region1.features.luckyNumbers.join('ã€') || 'æš‚æ— '}}</view>
                <view class="compare-cell">{{compareData.region2.features.luckyNumbers.join('ã€') || 'æš‚æ— '}}</view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
  
  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content">
    <view class="card">
      <view class="card-title">
        <text class="icon">ğŸ“š</text>
        <text>åœ°åŸŸä¹ ä¿—ä»‹ç»</text>
      </view>
      
      <view class="form-group">
        <view class="form-label">é€‰æ‹©çœä»½</view>
        <picker 
          mode="selector" 
          range="{{regions}}" 
          range-key="name"
          value="{{selectedRegionIndex}}"
          bindchange="onRegionChange"
        >
          <view class="form-input">
            {{regions[selectedRegionIndex] ? regions[selectedRegionIndex].name : 'è¯·é€‰æ‹©çœä»½'}}
          </view>
        </picker>
      </view>

      <!-- æ ‡ç­¾åˆ‡æ¢ - ä¼˜åŒ–ä¸ºå‚ç›´å¸ƒå±€ -->
      <view class="tab-list">
        <view
          class="tab-item {{customsTab === 'gift' ? 'active' : ''}}"
          bindtap="switchCustomsTab"
          data-tab="gift"
        >
          <text class="tab-icon">ğŸ§§</text>
          <text class="tab-text">å‹å²é’±</text>
        </view>
        <view
          class="tab-item {{customsTab === 'giving' ? 'active' : ''}}"
          bindtap="switchCustomsTab"
          data-tab="giving"
        >
          <text class="tab-icon">ğŸ’•</text>
          <text class="tab-text">éšä»½å­</text>
        </view>
        <view
          class="tab-item {{customsTab === 'special' ? 'active' : ''}}"
          bindtap="switchCustomsTab"
          data-tab="special"
        >
          <text class="tab-icon">ğŸ‰</text>
          <text class="tab-text">ç‰¹æ®Šåœºåˆ</text>
        </view>
      </view>

      <!-- å‹å²é’±ä¹ ä¿—å†…å®¹ -->
      <block wx:if="{{customsTab === 'gift'}}">
        <view class="space-y-4">
          <view class="bg-red-50 p-3 rounded-lg">
            <view class="flex items-center justify-between mb-2">
              <text class="text-sm font-medium text-gray-600">é‡‘é¢åŒºé—´</text>
              <text class="text-red-600">ğŸ“ˆ</text>
            </view>
              <view class="text-xl font-bold text-red-600">
                {{giftMoneyData.giftMoney.amount || 'æš‚æ— æ•°æ®'}}
              </view>
          </view>

          <view>
            <view class="form-label">å½“åœ°ä¹ ä¿—</view>
            <view class="space-y-2">
              <block wx:for="{{giftMoneyData.giftMoney.customs || []}}" wx:key="*this">
                <view class="flex items-start">
                  <text class="text-red-600 mr-2">â€¢</text>
                  <text class="text-sm text-gray-600">{{item}}</text>
                </view>
              </block>
            </view>
          </view>

          <view class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
            <view class="form-label text-yellow-800">è´´å¿ƒæç¤º</view>
              <text class="text-sm text-yellow-700">
                {{giftMoneyData.giftMoney.tips || 'æš‚æ— æç¤º'}}
              </text>
          </view>

          <!-- æ·±åº¦è§£è¯»æŒ‰é’®ï¼ˆæš‚æ—¶éšè—ï¼Œç­‰å¾…æ­£å¼ç‰ˆå¹¿å‘ŠIDï¼‰ -->
          <!--
          <view class="mt-4">
            <button 
              class="btn btn-secondary w-full" 
              bindtap="unlockDeepReading"
            >
              <text class="btn-icon">ğŸ¬</text>
              <text class="btn-text">
                <text wx:if="{{!unlockedDeepReadings.includes(selectedRegion)}}">è§‚çœ‹è§†é¢‘ï¼Œè§£é”æ·±åº¦è§£è¯»</text>
                <text wx:if="{{unlockedDeepReadings.includes(selectedRegion)}}">ğŸ“– æŸ¥çœ‹æ·±åº¦è§£è¯»</text>
              </text>
            </button>
          </view>
          -->
        </view>
      </block>

      <!-- éšä»½å­ä¹ ä¿—å†…å®¹ -->
      <block wx:if="{{customsTab === 'giving'}}">
        <view class="space-y-4">
          <view class="grid grid-cols-2 gap-4">
            <view class="bg-red-50 p-3 rounded-lg">
              <view class="flex items-center justify-between mb-2">
                <text class="text-sm font-medium text-gray-600">æ™®é€šåŒäº‹</text>
                <text class="text-red-600">ğŸ‘¥</text>
              </view>
              <view class="text-lg font-bold text-red-600">
                {{giftGivingData.giving.colleague || 'æš‚æ— æ•°æ®'}}
              </view>
            </view>

            <view class="bg-orange-50 p-3 rounded-lg">
              <view class="flex items-center justify-between mb-2">
                <text class="text-sm font-medium text-gray-600">å¥½æœ‹å‹</text>
                <text class="text-orange-600">ğŸ’•</text>
              </view>
              <view class="text-lg font-bold text-orange-600">
                {{giftGivingData.giving.friend || 'æš‚æ— æ•°æ®'}}
              </view>
            </view>
          </view>

          <view>
            <view class="form-label">å½“åœ°ä¹ ä¿—</view>
            <view class="space-y-2">
              <block wx:for="{{giftGivingData.giving.customs || []}}" wx:key="*this">
                <view class="flex items-start">
                  <text class="text-red-600 mr-2">â€¢</text>
                  <text class="text-sm text-gray-600">{{item}}</text>
                </view>
              </block>
            </view>
          </view>

          <view class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
            <view class="form-label text-yellow-800">è´´å¿ƒæç¤º</view>
            <text class="text-sm text-yellow-700">
              {{giftGivingData.giving.tips || 'æš‚æ— æç¤º'}}
            </text>
          </view>

          <!-- æ·±åº¦è§£è¯»æŒ‰é’®ï¼ˆæš‚æ—¶éšè—ï¼Œç­‰å¾…æ­£å¼ç‰ˆå¹¿å‘ŠIDï¼‰ -->
          <!--
          <view class="mt-4">
            <button
              class="btn btn-secondary w-full"
              bindtap="unlockDeepReading"
            >
              <text class="btn-icon">ğŸ¬</text>
              <text class="btn-text">
                <text wx:if="{{!unlockedDeepReadings.includes(selectedRegion)}}">è§‚çœ‹è§†é¢‘ï¼Œè§£é”æ·±åº¦è§£è¯»</text>
                <text wx:if="{{unlockedDeepReadings.includes(selectedRegion)}}">ğŸ“– æŸ¥çœ‹æ·±åº¦è§£è¯»</text>
              </text>
            </button>
          </view>
          -->
        </view>
      </block>

      <!-- ç‰¹æ®Šåœºåˆå†…å®¹ - ä¼˜åŒ–ä¸ºæ›´ç´§å‡‘çš„å¸ƒå±€ -->
      <block wx:if="{{customsTab === 'special'}}">
        <view class="space-y-3">
          <!-- ç®€åŒ–ï¼šç´§å‡‘çš„å¡ç‰‡åˆ—è¡¨ -->
          <view class="occasion-compact-list">
            <!-- å©šç¤¼ä¹ ä¿— -->
            <view class="occasion-compact-item" bindtap="toggleOccasionDetail" data-type="wedding">
              <text class="compact-icon">ğŸ’’</text>
              <view class="compact-info">
                <text class="compact-title">å©šç¤¼</text>
                <text class="compact-amount">{{giftMoneyData.specialOccasions.wedding.amount || 'æš‚æ— æ•°æ®'}}</text>
              </view>
              <text class="compact-arrow">></text>
            </view>
            <!-- ç”Ÿæ—¥ä¹ ä¿— -->
            <view class="occasion-compact-item" bindtap="toggleOccasionDetail" data-type="birthday">
              <text class="compact-icon">ğŸ‚</text>
              <view class="compact-info">
                <text class="compact-title">ç”Ÿæ—¥</text>
                <text class="compact-amount">{{giftMoneyData.specialOccasions.birthday.amount || 'æš‚æ— æ•°æ®'}}</text>
              </view>
              <text class="compact-arrow">></text>
            </view>
            <!-- è‘¬ç¤¼ä¹ ä¿— -->
            <view class="occasion-compact-item" bindtap="toggleOccasionDetail" data-type="funeral">
              <text class="compact-icon">âš°ï¸</text>
              <view class="compact-info">
                <text class="compact-title">è‘¬ç¤¼</text>
                <text class="compact-amount">{{giftMoneyData.specialOccasions.funeral.amount || 'æš‚æ— æ•°æ®'}}</text>
              </view>
              <text class="compact-arrow">></text>
            </view>
          </view>

          <!-- å±•å¼€å¼è¯¦æƒ…ï¼ˆç‚¹å‡»åæ˜¾ç¤ºï¼‰ -->
          <view wx:if="{{expandedOccasion}}" class="occasion-detail-section">
            <view class="detail-card">
              <view class="detail-header">
                <text class="detail-title">{{expandedOccasion.title}}</text>
                <text class="detail-close" bindtap="toggleOccasionDetail">âœ•</text>
              </view>
              <view class="detail-content">
                <view class="detail-section">
                  <view class="detail-label">å½“åœ°ä¹ ä¿—</view>
                  <block wx:for="{{expandedOccasion.customs}}" wx:key="*this">
                    <view class="detail-item">â€¢ {{item}}</view>
                  </block>
                </view>
                <view class="detail-tip-box">
                  <view class="detail-tip-label">è´´å¿ƒæç¤º</view>
                  <text class="detail-tip-text">{{expandedOccasion.tips}}</text>
                </view>
              </view>
            </view>
          </view>

          <!-- ç¦å¿Œæ–‡åŒ– -->
          <view class="taboo-section">
            <view class="taboo-header">
              <text class="taboo-icon">âš ï¸</text>
              <text class="taboo-title">ç¦å¿Œæ–‡åŒ–</text>
            </view>
            <view class="taboo-content">
              <block wx:for="{{giftMoneyData.taboo || []}}" wx:key="*this">
                <view class="taboo-item">{{item}}</view>
              </block>
            </view>
          </view>

          <!-- æ–‡åŒ–æ•…äº‹ -->
          <view class="story-section">
            <view class="story-header">
              <text class="story-icon">ğŸ“–</text>
              <text class="story-title">æ–‡åŒ–æ•…äº‹</text>
            </view>
            <view class="story-content">
              <text class="story-text">{{giftMoneyData.story || 'æš‚æ— æ–‡åŒ–æ•…äº‹'}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- ç”¨æˆ·åé¦ˆç»„ä»¶ -->
  <feedback pageName="customs" />
</view>
