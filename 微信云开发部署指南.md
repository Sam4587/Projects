# 🚀 微信云开发 + 混元AI 智能红包助手部署指南

## 🎯 项目升级概述

利用您获取的微信云开发资源和混元AI免费Token，我们将重构项目为：

- ✅ **AI智能翻译** - 混元大模型理解语义，智能生成地域化祝福语
- ✅ **云原生架构** - 免服务器管理，自动扩缩容
- ✅ **智能反馈系统** - AI自动分类，智能通知，云端存储
- ✅ **个性化推荐** - 学习用户偏好，提供定制化祝福语

## 📋 前期准备

### 🔑 您的资源信息
- **云开发环境ID**: `cloudbase-0gkqu2y430f74aa9`
- **腾讯云账号**: `100045935425`
- **混元AI Token**: 免费额度充足

### 🛠️ 工具准备
1. **微信开发者工具**（最新版）
2. **云开发控制台**访问权限
3. **Node.js** 开发环境

## 🚀 部署步骤

### 阶段1：微信开发者工具配置（5分钟）

#### 步骤1：打开项目
1. 启动微信开发者工具
2. 打开您的 `redpacket-advisor` 项目
3. 确保项目类型为"小程序"

#### 步骤2：配置云开发
1. 点击工具栏的"云开发"按钮 ☁️
2. 在弹窗中选择"开通云开发"
3. 选择环境ID：`cloudbase-0gkqu2y430f74aa9`
4. 等待环境初始化完成

#### 步骤3：初始化基本配置
1. 在`project.config.json`中添加：
```json
{
  "cloudfunctionRoot": "cloudbase-functions/",
  "miniprogramRoot": "./",
  "setting": {
    "urlCheck": false,
    "es6": true,
    "enhance": true,
    "compileHotReLoad": true
  }
}
```

### 阶段2：上传云函数（10分钟）

#### 方法1：可视化上传（推荐）

1. **打开云函数管理**
   - 在开发者工具中点击"云开发控制台"
   - 进入"云函数"页面

2. **逐个创建云函数**
   
   **函数1：AI智能翻译**
   - 函数名：`ai-translator`
   - 运行环境：Node.js 16.13
   - 执行方法：`index.main`  
   - 上传代码：选择`cloudbase-functions/ai-translator`目录
   - 环境变量：`HUNYUAN_API_KEY` = 您的混元API密钥

   **函数2：用户反馈**
   - 函数名：`user-feedback`
   - 运行环境：Node.js 16.13
   - 执行方法：`index.main`
   - 上传代码：选择`cloudbase-functions/user-feedback`目录

   **函数3：祝福语生成**
   - 函数名：`blessings-generator`
   - 运行环境：Node.js 16.13
   - 执行方法：`index.main`
   - 上传代码：选择`cloudbase-functions/blessings-generator`目录

   **函数4：数据库初始化**
   - 函数名：`database-init`
   - 运行环境：Node.js 16.13
   - 执行方法：`index.main`
   - 上传代码：选择`cloudbase-functions/database-init`目录

#### 方法2：命令行上传
```bash
# 安装云开发CLI
npm install -g @cloudbase/cli

# 登录
cloudbase login

# 上传云函数
cloudbase functions:deploy ai-translator -e cloudbase-0gkqu2y430f74aa9
cloudbase functions:deploy user-feedback -e cloudbase-0gkqu2y430f74aa9
cloudbase functions:deploy blessings-generator -e cloudbase-0gkqu2y430f74aa9
cloudbase functions:deploy database-init -e cloudbase-0gkqu2y430f74aa9
```

### 阶段3：初始化数据库（3分钟）

#### 步骤1：调用初始化函数
```javascript
// 在小程序中调用初始化函数
wx.cloud.callFunction({
  name: 'database-init',
  success: res => {
    console.log('数据库初始化成功', res);
  },
  fail: err => {
    console.error('初始化失败', err);
  }
});
```

#### 步骤2：查看集合创建结果
1. 进入云开发控制台
2. 点击"数据库"页面
3. 确认创建了以下集合：
   - `blessings_library` - 祝福语库
   - `user_feedback` - 用户反馈
   - `translation_logs` - 翻译日志
   - `translation_results` - 翻译结果
   - `admin_users` - 管理员用户
   - `system_stats` - 系统统计

### 阶段4：配置混元AI（2分钟）

#### 步骤1：获取混元API密钥
1. 访问腾讯云控制台：https://console.cloud.tencent.com/hunyuan
2. 创建API密钥
3. 将密钥设置为`HUNYUAN_API_KEY`环境变量

#### 步骤2：在云函数中配置
在每个云函数的环境变量中设置：
- `HUNYUAN_API_KEY` = 您的实际API密钥

### 阶段5：更新小程序前端（5分钟）

#### 步骤1：修改全局配置文件
更新`app.js`或相应的配置文件：
```javascript
// app.js
App({
  globalData: {
    env: 'cloudbase-0gkqu2y430f74aa9',
    functions: {
      aiTranslator: 'ai-translator',
      userFeedback: 'user-feedback',
      blessingsGen: 'blessings-generator'
    }
  },
  onLaunch: function () {
    // 初始化云开发
    if (!wx.cloud) {
      console.error('请使用 2.2.3 或以上的基础库以使用云能力');
    } else {
      wx.cloud.init({
        env: this.globalData.env,
        traceUser: true
      });
    }
  }
});
```

#### 步骤2：更新翻译页面
修改`pages/translator/translator.js`：
```javascript
// 调用AI云函数进行翻译
translateWithAI(text, region, category) {
  wx.cloud.callFunction({
    name: 'ai-translator',
    data: {
      text,
      region: region || '通用',
      category: category || '通用祝福',
      userId: wx.getStorageSync('userInfo')?.openid
    },
    success: res => {
      if (res.result.code === 0) {
        this.processTranslationResult(res.result.data);
      } else {
        this.showLocalTranslation(text);
      }
    },
    fail: err => {
      console.error('AI翻译失败:', err);
      this.showLocalTranslation(text);
    }
  });
}
```

#### 步骤3：更新反馈功能
修改反馈按钮点击事件：
```javascript
submitFeedback() {
  const userInfo = wx.getStorageSync('userInfo') || {};
  
  wx.cloud.callFunction({
    name: 'user-feedback',
    data: {
      content: this.data.feedbackContent,
      category: this.data.selectedCategory,
      page: 'pages/translator/translator',
      userInfo,
      contactInfo: this.data.contactInfo
    },
    success: res => {
      if (res.result.code === 0) {
        wx.showToast({
          title: '反馈提交成功',
          icon: 'success'
        });
      }
    }
  });
}
```

## 🧪 功能测试

### 测试1：AI翻译功能
1. 在翻译页面输入：