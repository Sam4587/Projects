# éšç¤¼é‚£ç‚¹äº‹å„¿å°ç¨‹åº - æ€§èƒ½ç“¶é¢ˆåˆ†ææŠ¥å‘Š

> åˆ†ææ—¥æœŸ: 2026-02-05
> é¡¹ç›®ç‰ˆæœ¬: v1.0.0
> åˆ†æèŒƒå›´: å…¨é‡ä»£ç åº“(113ä¸ªæ–‡ä»¶)

---

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯
- **é¡¹ç›®ç±»å‹**: å¾®ä¿¡å°ç¨‹åº
- **æ ¸å¿ƒåŠŸèƒ½**: éšç¤¼è®¡ç®—å™¨ã€çº¢åŒ…ç¿»è¯‘å™¨ã€åœ°åŸŸä¹ ä¿—åº“ã€ç”¨æˆ·åé¦ˆ
- **æŠ€æœ¯æ ˆ**: å¾®ä¿¡å°ç¨‹åºåŸç”Ÿå¼€å‘ + ES6+
- **ä»£ç è§„æ¨¡**: 113ä¸ªæ–‡ä»¶,æ¶µç›–é¡µé¢ã€ç»„ä»¶ã€å·¥å…·ç±»ã€é…ç½®æ–‡ä»¶

### é¡¹ç›®ç»“æ„
```
éšç¤¼é‚£ç‚¹äº‹å„¿/
â”œâ”€â”€ pages/              # 4ä¸ªä¸»è¦é¡µé¢
â”‚   â”œâ”€â”€ calculator/    # éšç¤¼è®¡ç®—å™¨
â”‚   â”œâ”€â”€ translator/    # çº¢åŒ…ç¿»è¯‘å™¨
â”‚   â”œâ”€â”€ customs/       # åœ°åŸŸä¹ ä¿—åº“
â”‚   â””â”€â”€ stats/         # ç»Ÿè®¡é¡µé¢
â”œâ”€â”€ components/         # 2ä¸ªç»„ä»¶
â”‚   â”œâ”€â”€ feedback/      # åé¦ˆç»„ä»¶
â”‚   â””â”€â”€ tabbar-icon/   # æ ‡ç­¾æ å›¾æ ‡
â”œâ”€â”€ utils/             # å·¥å…·ç±»æ¨¡å—
â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
â””â”€â”€ cloudbase-functions/ # äº‘å‡½æ•°
```

---

## ğŸ” æ½œåœ¨æ€§èƒ½ç“¶é¢ˆåˆ†æ

### 1. âš ï¸ é«˜ä¼˜å…ˆçº§æ€§èƒ½é—®é¢˜

#### 1.1 åœ°åŸŸä¹ ä¿—æ•°æ®åŠ è½½æ•ˆç‡ä½ (P0)
**é—®é¢˜æè¿°**:
- `pages/customs/customs.js` åœ¨é¡µé¢åŠ è½½æ—¶é€šè¿‡34ä¸ªé™æ€ `require` åŠ è½½æ‰€æœ‰çœä»½é…ç½®æ–‡ä»¶
- æ•°æ®åŠ è½½ä½¿ç”¨äº† `setTimeout` å»¶è¿Ÿ800ms,é€ æˆä¸å¿…è¦çš„ç­‰å¾…æ—¶é—´
- æ¯æ¬¡åˆ‡æ¢åœ°åŒºéƒ½ä¼šè§¦å‘å¼‚æ­¥åŠ è½½,å³ä½¿æ•°æ®å·²ç»åœ¨å†…å­˜ä¸­

**å½±å“èŒƒå›´**: åœ°åŸŸä¹ ä¿—é¡µé¢

**æ€§èƒ½å½±å“**:
- é¦–æ¬¡åŠ è½½: ~800ms äººä¸ºå»¶è¿Ÿ
- åœ°åŒºåˆ‡æ¢: ~300ms äººä¸ºå»¶è¿Ÿ
- å†…å­˜å ç”¨: 34ä¸ªæ•°æ®æ¨¡å—å…¨éƒ¨åŠ è½½åˆ°å†…å­˜

**ä¼˜åŒ–å»ºè®®**:
```javascript
// æ–¹æ¡ˆ1: æŒ‰éœ€åŠ¨æ€åŠ è½½
const loadRegionData = (regionId) => {
  return new Promise((resolve, reject) => {
    require(`../../config/customs/${regionId}.js`, (data) => {
      resolve(data);
    }, reject);
  });
};

// æ–¹æ¡ˆ2: ç¼“å­˜å·²åŠ è½½æ•°æ®
const regionCache = new Map();
const loadRegionData = async (regionId) => {
  if (regionCache.has(regionId)) {
    return regionCache.get(regionId);
  }
  const data = await import(`../../config/customs/${regionId}.js`);
  regionCache.set(regionId, data);
  return data;
};
```

#### 1.2 ç¥ç¦è¯­æ•°æ®æœç´¢æ•ˆç‡ä½ (P0)
**é—®é¢˜æè¿°**:
- `pages/translator/translator.js` æ¯æ¬¡åˆ‡æ¢åˆ†ç±»éƒ½é‡æ–°åŠ è½½æ•°æ®
- æœç´¢åŠŸèƒ½ä½¿ç”¨åŒé‡ `for` å¾ªç¯,æ—¶é—´å¤æ‚åº¦ O(nÂ²)
- æ•°æ®åŠ è½½ä½¿ç”¨äº†300msäººä¸ºå»¶è¿Ÿ

**å½±å“èŒƒå›´**: çº¢åŒ…ç¿»è¯‘å™¨é¡µé¢

**æ€§èƒ½å½±å“**:
- åˆ†ç±»åˆ‡æ¢: ~300ms äººä¸ºå»¶è¿Ÿ
- æœç´¢æ€§èƒ½: éšæ•°æ®é‡å¢é•¿çº¿æ€§ä¸‹é™
- é‡å¤åŠ è½½: åŒä¸€æ•°æ®è¢«å¤šæ¬¡åŠ è½½

**ä¼˜åŒ–å»ºè®®**:
```javascript
// æ–¹æ¡ˆ1: å»ºç«‹ç´¢å¼•åŠ é€Ÿæœç´¢
const phraseIndex = new Map();
phrases.forEach(phrase => {
  phraseIndex.set(phrase.traditional, phrase);
});

// æŸ¥æ‰¾æ—¶ O(1) æ—¶é—´å¤æ‚åº¦
const found = phraseIndex.get(inputText);

// æ–¹æ¡ˆ2: ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æœç´¢è¾“å…¥
import { debounce } from '../../utils/common';

const handleInput = debounce((value) => {
  this.performSearch(value);
}, 300);
```

#### 1.3 å­˜å‚¨ç›‘æ§å®šæ—¶å™¨é¢‘ç¹æ‰§è¡Œ (P0)
**é—®é¢˜æè¿°**:
- `app.js` å¯åŠ¨äº†ä¸¤ä¸ªå®šæ—¶å™¨:
  - å­˜å‚¨ç›‘æ§: æ¯60ç§’æ‰§è¡Œä¸€æ¬¡
  - ç¼“å­˜æ¸…ç†: æ¯24å°æ—¶æ‰§è¡Œä¸€æ¬¡
- å­˜å‚¨ç›‘æ§æ¯æ¬¡éƒ½ä¼šéå†æ‰€æœ‰å­˜å‚¨é”®,æ£€æŸ¥è¿‡æœŸæ—¶é—´
- åœ¨åº”ç”¨æ´»è·ƒæœŸé—´æŒç»­è¿è¡Œ,å ç”¨CPUèµ„æº

**å½±å“èŒƒå›´**: å…¨å±€åº”ç”¨ç”Ÿå‘½å‘¨æœŸ

**æ€§èƒ½å½±å“**:
- CPUå ç”¨: æŒç»­çš„åå°ä»»åŠ¡
- å†…å­˜å ç”¨: å®šæ—¶å™¨å¼•ç”¨ä¿æŒ
- ç”µæ± æ¶ˆè€—: æŒç»­çš„åå°æ‰§è¡Œ

**ä¼˜åŒ–å»ºè®®**:
```javascript
// æ–¹æ¡ˆ1: åº”ç”¨éšè—æ—¶æš‚åœç›‘æ§
onHide() {
  if (this.storageMonitorInterval) {
    clearInterval(this.storageMonitorInterval);
  }
}

onShow() {
  this.initStorageMonitor();
}

// æ–¹æ¡ˆ2: åŸºäºäº‹ä»¶è§¦å‘è€Œéå®šæ—¶
checkStorageHealth() {
  const storageInfo = wx.getStorageInfoSync();
  const usageRate = storageInfo.currentSize / storageInfo.limitSize;

  // åªåœ¨è¾¾åˆ°é˜ˆå€¼æ—¶æ‰æ‰§è¡Œæ¸…ç†
  if (usageRate > 0.8) {
    this.cleanExpiredCache();
  }
}
```

---

### 2. âš¡ ä¸­ä¼˜å…ˆçº§æ€§èƒ½é—®é¢˜

#### 2.1 ç»Ÿè®¡æ¨¡å—é˜Ÿåˆ—ç®¡ç†ä½æ•ˆ (P1)
**é—®é¢˜æè¿°**:
- `utils/analytics.js` äº‹ä»¶é˜Ÿåˆ—æ— ä¸Šé™æ£€æŸ¥
- æ¯æ¬¡flushéƒ½ä¼šå®Œæ•´é‡å†™å­˜å‚¨æ•°æ®
- æœ€å¤§é˜Ÿåˆ—é™åˆ¶1000æ¡,å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º

**å½±å“èŒƒå›´**: å…¨å±€æ•°æ®ç»Ÿè®¡

**æ€§èƒ½å½±å“**:
- å­˜å‚¨å†™å…¥: å¤§é‡JSONåºåˆ—åŒ–/ååºåˆ—åŒ–
- å†…å­˜å ç”¨: é˜Ÿåˆ—å¯èƒ½æ— é™å¢é•¿
- æ•°æ®ä¸¢å¤±: é˜Ÿåˆ—æ»¡æ—¶ç›´æ¥ä¸¢å¼ƒæ—§æ•°æ®

**ä¼˜åŒ–å»ºè®®**:
```javascript
// æ–¹æ¡ˆ1: å¢é‡å­˜å‚¨è€Œéå…¨é‡è¦†ç›–
flush() {
  const key = `analytics_events_${new Date().toDateString()}`;
  const newData = this.eventQueue.slice(0, 50); // æ¯æ¬¡åªå­˜50æ¡

  // ä½¿ç”¨è¿½åŠ æ¨¡å¼
  const existing = wx.getStorageSync(key) || [];
  const updated = existing.concat(newData);

  wx.setStorageSync(key, updated);
  this.eventQueue = [];
}

// æ–¹æ¡ˆ2: å®ç°çœŸæ­£çš„å¢é‡å­˜å‚¨
appendEvents(events) {
  const key = `analytics_events_${new Date().toDateString()}`;
  wx.getStorage({
    key,
    success(res) {
      const updated = res.data.concat(events);
      wx.setStorage({ key, data: updated });
    },
    fail() {
      wx.setStorage({ key, data: events });
    }
  });
}
```

#### 2.2 åé¦ˆç»„ä»¶æ‹–æ‹½æ€§èƒ½é—®é¢˜ (P1)
**é—®é¢˜æè¿°**:
- `components/feedback/feedback.js` æ‹–æ‹½è¿‡ç¨‹ä¸­é¢‘ç¹è°ƒç”¨ `setData`
- æ¯æ¬¡ç§»åŠ¨éƒ½ä¼šè§¦å‘é¡µé¢é‡ç»˜
- æ²¡æœ‰ä½¿ç”¨èŠ‚æµ/é˜²æŠ–ä¼˜åŒ–

**å½±å“èŒƒå›´**: åé¦ˆæŒ‰é’®æ‹–æ‹½äº¤äº’

**æ€§èƒ½å½±å“**:
- æ¸²æŸ“æ€§èƒ½: é¢‘ç¹çš„é¡µé¢æ›´æ–°
- ç”¨æˆ·ä½“éªŒ: æ‹–æ‹½å¯èƒ½ä¸æµç•…
- CPUå ç”¨: å¤§é‡çš„è®¡ç®—å’Œæ¸²æŸ“

**ä¼˜åŒ–å»ºè®®**:
```javascript
// æ–¹æ¡ˆ1: ä½¿ç”¨èŠ‚æµä¼˜åŒ–æ‹–æ‹½
import { throttle } from '../../utils/common';

onTouchMove: throttle(function(e) {
  if (e.cancelable && e.preventDefault) {
    e.preventDefault();
  }

  const touch = e.touches[0];
  // ... è®¡ç®—é€»è¾‘
  this.updateButtonPosition(newX, newY);
}, 16), // 60fps, çº¦16msä¸€æ¬¡

// æ–¹æ¡ˆ2: åˆ†ç¦»æ‹–æ‹½é¢„è§ˆå’Œæœ€ç»ˆç¡®è®¤
onTouchMove(e) {
  // åªæ›´æ–°å†…éƒ¨çŠ¶æ€,ä¸è°ƒç”¨setData
  this._tempPosition = { x: newX, y: newY };

  // ä½¿ç”¨requestAnimationFrame
  if (!this._rafId) {
    this._rafId = requestAnimationFrame(() => {
      this.setData({ 'btnPosition': this._tempPosition });
      this._rafId = null;
    });
  }
}
```

#### 2.3 å¹¿å‘Šé…ç½®æ¨¡å—å†—ä½™ä»£ç  (P1)
**é—®é¢˜æè¿°**:
- `utils/ad-config.js` åŒ…å«å¤§é‡æ¨¡æ‹Ÿä»£ç 
- æ‰€æœ‰å¹¿å‘ŠåŠŸèƒ½éƒ½æ˜¯æ—¥å¿—è¾“å‡º,å®é™…æœªå®ç°
- å ç”¨ä»£ç ç©ºé—´ä½†æ— å®é™…ä½œç”¨

**å½±å“èŒƒå›´**: ä»£ç ç»´æŠ¤å’Œå¯è¯»æ€§

**æ€§èƒ½å½±å“**:
- åŒ…ä½“ç§¯: æ— ç”¨ä»£ç å¢åŠ åŒ…å¤§å°
- å¯ç»´æŠ¤æ€§: å¢åŠ ç†è§£å’Œç»´æŠ¤æˆæœ¬
- æ··æ·†: è®©äººä»¥ä¸ºå¹¿å‘Šå·²å®ç°

**ä¼˜åŒ–å»ºè®®**:
```javascript
// æ–¹æ¡ˆ1: ç§»é™¤æœªå®ç°çš„åŠŸèƒ½
// å¦‚æœå¹¿å‘ŠåŠŸèƒ½æš‚ä¸å¯ç”¨,å»ºè®®:
// 1. å®Œå…¨ç§»é™¤å¹¿å‘Šç›¸å…³ä»£ç 
// 2. æˆ–ä½¿ç”¨æ¡ä»¶ç¼–è¯‘
const ENABLE_ADS = false;

class AdManager {
  createInterstitialAd() {
    if (!ENABLE_ADS) return;
    // å®é™…å¹¿å‘Šé€»è¾‘
  }
}

// æ–¹æ¡ˆ2: å®ç°çœŸæ­£çš„å¹¿å‘ŠåŠŸèƒ½
// å‚è€ƒå¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£å®ç°
createInterstitialAd() {
  this.interstitialAd = wx.createInterstitialAd({
    adUnitId: this.config.interstitial.adId
  });

  this.interstitialAd.onLoad(() => {
    console.log('æ’å±å¹¿å‘ŠåŠ è½½æˆåŠŸ');
  });

  this.interstitialAd.onError((err) => {
    console.error('æ’å±å¹¿å‘ŠåŠ è½½å¤±è´¥:', err);
  });
}
```

---

### 3. ğŸ’¡ ä½ä¼˜å…ˆçº§ä¼˜åŒ–å»ºè®®

#### 3.1 å›¾ç‰‡èµ„æºä¼˜åŒ– (P2)
**é—®é¢˜æè¿°**:
- æ ‡ç­¾æ å›¾æ ‡ä½¿ç”¨PNGæ ¼å¼
- æœªæä¾›ä¸åŒå°ºå¯¸çš„é€‚é…èµ„æº

**ä¼˜åŒ–å»ºè®®**:
- è½¬æ¢ä¸ºWebPæ ¼å¼,å‡å°‘30%+æ–‡ä»¶å¤§å°
- ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºå›¾ç‰‡å‹ç¼©API
- æŒ‰å±å¹•å¯†åº¦æä¾›å¤šå¥—èµ„æº

#### 3.2 ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½ (P2)
**é—®é¢˜æè¿°**:
- æ‰€æœ‰é¡µé¢ä»£ç åœ¨åº”ç”¨å¯åŠ¨æ—¶éƒ½ä¼šè¢«åŠ è½½
- é…ç½®æ–‡ä»¶ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½

**ä¼˜åŒ–å»ºè®®**:
```javascript
// ä½¿ç”¨å°ç¨‹åºåˆ†åŒ…åŠ è½½
{
  "subpackages": [
    {
      "root": "packageA",
      "pages": [
        "pages/customs/customs"
      ]
    }
  ]
}

// æŒ‰éœ€åŠ è½½å·¥å…·æ¨¡å—
const loadAnalytics = () => {
  return new Promise((resolve) => {
    require('../../utils/analytics.js', (module) => {
      resolve(module.analytics);
    });
  });
};
```

#### 3.3 ç¼“å­˜ç­–ç•¥ä¼˜åŒ– (P2)
**é—®é¢˜æè¿°**:
- æ•°æ®åŠ è½½æ²¡æœ‰ç¼“å­˜æœºåˆ¶
- ç›¸åŒè¯·æ±‚é‡å¤æ‰§è¡Œ

**ä¼˜åŒ–å»ºè®®**:
```javascript
// å®ç°ç»Ÿä¸€çš„ç¼“å­˜ç®¡ç†å™¨
class CacheManager {
  constructor() {
    this.cache = new Map();
    this.expiryTimes = new Map();
  }

  set(key, value, ttl = 60000) {
    this.cache.set(key, value);
    this.expiryTimes.set(key, Date.now() + ttl);
  }

  get(key) {
    const expiry = this.expiryTimes.get(key);
    if (expiry && Date.now() > expiry) {
      this.cache.delete(key);
      this.expiryTimes.delete(key);
      return null;
    }
    return this.cache.get(key);
  }
}
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡é¢„ä¼°

### å½“å‰æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | å·®è· |
|------|--------|--------|------|
| é¦–å±åŠ è½½æ—¶é—´ | ~2-3ç§’ | <1ç§’ | -100% |
| åœ°åŒºåˆ‡æ¢å“åº” | ~300ms | <100ms | -200% |
| æœç´¢å“åº”æ—¶é—´ | ~100ms | <50ms | -100% |
| å†…å­˜å ç”¨ | ~5-10MB | <5MB | -100% |
| åŒ…ä½“ç§¯ | ~500KB | <400KB | -25% |

### ä¼˜åŒ–åé¢„æœŸæŒ‡æ ‡
| æŒ‡æ ‡ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|----------|
| é¦–å±åŠ è½½æ—¶é—´ | <1ç§’ | 60%+ |
| åœ°åŒºåˆ‡æ¢å“åº” | <50ms | 80%+ |
| æœç´¢å“åº”æ—¶é—´ | <10ms | 90%+ |
| å†…å­˜å ç”¨ | <3MB | 50%+ |
| åŒ…ä½“ç§¯ | <400KB | 20%+ |

---

## ğŸ¯ ä¼˜åŒ–ä¼˜å…ˆçº§å»ºè®®

### ç«‹å³å¤„ç† (1-2å‘¨å†…)
1. âœ… ç§»é™¤åœ°åŸŸä¹ ä¿—é¡µé¢çš„ä¸å¿…è¦å»¶è¿Ÿ
2. âœ… ä¼˜åŒ–ç¥ç¦è¯­æœç´¢ç®—æ³•
3. âœ… ä¼˜åŒ–å­˜å‚¨ç›‘æ§å®šæ—¶å™¨

### çŸ­æœŸä¼˜åŒ– (1ä¸ªæœˆå†…)
1. âœ… ä¼˜åŒ–ç»Ÿè®¡æ¨¡å—é˜Ÿåˆ—ç®¡ç†
2. âœ… ä¼˜åŒ–åé¦ˆç»„ä»¶æ‹–æ‹½æ€§èƒ½
3. âœ… æ¸…ç†å¹¿å‘Šé…ç½®å†—ä½™ä»£ç 

### ä¸­é•¿æœŸä¼˜åŒ– (3ä¸ªæœˆå†…)
1. âœ… å®ç°ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
2. âœ… ä¼˜åŒ–å›¾ç‰‡èµ„æº
3. âœ… å®Œå–„ç¼“å­˜ç­–ç•¥

---

## ğŸ“ å®æ–½å»ºè®®

### å¼€å‘æµç¨‹
1. **æ€§èƒ½æµ‹è¯•åŸºçº¿**: å…ˆå»ºç«‹æ€§èƒ½æµ‹è¯•åŸºçº¿,è®°å½•ä¼˜åŒ–å‰æ•°æ®
2. **åˆ†æ­¥ä¼˜åŒ–**: æŒ‰ä¼˜å…ˆçº§é€é¡¹ä¼˜åŒ–,æ¯æ¬¡ä¼˜åŒ–åéªŒè¯æ•ˆæœ
3. **æŒç»­ç›‘æ§**: ä¼˜åŒ–åæŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡,é˜²æ­¢å›é€€

### å·¥å…·æ¨è
- **æ€§èƒ½åˆ†æ**: å¾®ä¿¡å¼€å‘è€…å·¥å…·æ€§èƒ½åˆ†æé¢æ¿
- **ä»£ç åˆ†æ**: ESLint + Prettier
- **åŒ…ä½“ç§¯åˆ†æ**: å°ç¨‹åºä»£ç åŒ…åˆ†æå·¥å…·

### éªŒè¯æ–¹æ³•
- ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„Performanceé¢æ¿åˆ†æ
- ä½¿ç”¨çœŸæœºè°ƒè¯•æµ‹è¯•å®é™…æ€§èƒ½
- æ”¶é›†ç”¨æˆ·åé¦ˆäº†è§£çœŸå®ä½“éªŒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£
- å¾®ä¿¡å°ç¨‹åºæ€§èƒ½ä¼˜åŒ–å®˜æ–¹æ–‡æ¡£
- å°ç¨‹åºæœ€ä½³å®è·µæŒ‡å—
- é¡¹ç›®å¼€å‘æ–‡æ¡£

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-05
**åˆ†æäººå‘˜**: Claude AI Assistant
**ä¸‹æ¬¡å®¡æŸ¥å»ºè®®**: ä¼˜åŒ–å®Œæˆåé‡æ–°è¯„ä¼°
