<!-- pages/stats/stats.wxml -->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <text class="header-icon">ğŸ“Š</text>
    <text class="header-title">æ•°æ®ç»Ÿè®¡</text>
    <text class="header-subtitle">åº”ç”¨ä½¿ç”¨æ•°æ®åˆ†æ</text>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tab-bar">
    <view 
      wx:for="{{tabs}}" 
      wx:key="key"
      class="tab-item {{activeTab === item.key ? 'active' : ''}}"
      data-tab="{{item.key}}"
      bindtap="switchTab"
    >
      {{item.label}}
    </view>
  </view>

  <!-- æ¦‚è§ˆ Tab -->
  <view wx:if="{{activeTab === 'overview'}}" class="tab-content">
    <view class="stat-card">
      <view class="card-title">ğŸ“ˆ æ€»ä½“æ¦‚å†µ</view>
      <view class="stat-grid">
        <view class="stat-item">
          <text class="stat-value">{{report.overview.totalPageViews}}</text>
          <text class="stat-label">é¡µé¢è®¿é—®</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{report.overview.totalEvents}}</text>
          <text class="stat-label">äº‹ä»¶è§¦å‘</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{report.overview.totalErrors}}</text>
          <text class="stat-label">é”™è¯¯æ¬¡æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{report.overview.totalFeedback}}</text>
          <text class="stat-label">ç”¨æˆ·åé¦ˆ</text>
        </view>
      </view>
    </view>

    <view class="stat-card" wx:if="{{report.topPages.length > 0}}">
      <view class="card-title">ğŸ”¥ çƒ­é—¨é¡µé¢</view>
      <view class="list">
        <view wx:for="{{report.topPages}}" wx:key="page" class="list-item">
          <text class="item-name">{{item.page}}</text>
          <text class="item-value">{{item.count}}æ¬¡</text>
        </view>
      </view>
    </view>

    <view class="stat-card" wx:if="{{report.topEvents.length > 0}}">
      <view class="card-title">âš¡ çƒ­é—¨äº‹ä»¶</view>
      <view class="list">
        <view wx:for="{{report.topEvents}}" wx:key="event" class="list-item">
          <text class="item-name">{{item.event}}</text>
          <text class="item-value">{{item.count}}æ¬¡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åé¦ˆ Tab -->
  <view wx:if="{{activeTab === 'feedback'}}" class="tab-content">
    <view class="stat-card" wx:if="{{feedbackList.length > 0}}">
      <view class="card-title">ğŸ’¬ ç”¨æˆ·åé¦ˆ ({{feedbackList.length}}æ¡)</view>
      <view class="feedback-list">
        <view 
          wx:for="{{feedbackList}}" 
          wx:key="id" 
          class="feedback-item"
          data-index="{{index}}"
          bindtap="viewFeedbackDetail"
        >
          <view class="feedback-header">
            <text class="feedback-type">{{item.type}}</text>
            <text class="feedback-rating">{{item.rating}}â­</text>
          </view>
          <text class="feedback-content">{{item.content}}</text>
          <text class="feedback-time">{{formatDate(item.createTime)}}</text>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— ç”¨æˆ·åé¦ˆ</text>
    </view>
  </view>

  <!-- äº‹ä»¶ Tab -->
  <view wx:if="{{activeTab === 'events'}}" class="tab-content">
    <view class="stat-card" wx:if="{{todayEvents.length > 0}}">
      <view class="card-title">ğŸ“… ä»Šæ—¥äº‹ä»¶ ({{todayEvents.length}}æ¡)</view>
      <view class="event-list">
        <view wx:for="{{todayEvents}}" wx:key="timestamp" class="event-item">
          <view class="event-dot {{item.type}}"></view>
          <view class="event-info">
            <text class="event-type">{{item.type}}</text>
            <text class="event-detail" wx:if="{{item.event}}">{{item.event}}</text>
            <text class="event-detail" wx:if="{{item.page}}">{{item.page}}</text>
          </view>
          <text class="event-time">{{formatDate(item.timestamp)}}</text>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">ä»Šæ—¥æš‚æ— äº‹ä»¶è®°å½•</text>
    </view>
  </view>

  <!-- æ€§èƒ½ Tab -->
  <view wx:if="{{activeTab === 'performance'}}" class="tab-content">
    <view class="stat-card" wx:if="{{report.performance && Object.keys(report.performance).length > 0}}">
      <view class="card-title">âš¡ æ€§èƒ½æŒ‡æ ‡</view>
      <view class="performance-list">
        <view 
          wx:for="{{report.performance}}" 
          wx:for-item="data" 
          wx:for-index="metric"
          wx:key="metric"
          class="performance-item"
        >
          <text class="metric-name">{{metric}}</text>
          <view class="metric-stats">
            <text class="metric-avg">å¹³å‡: {{data.avg}}ms</text>
            <text class="metric-range">èŒƒå›´: {{data.min}}-{{data.max}}ms</text>
          </view>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æš‚æ— æ€§èƒ½æ•°æ®</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-bar">
    <button class="btn btn-secondary" bindtap="exportStats">ğŸ“‹ å¯¼å‡ºæŠ¥å‘Š</button>
    <button class="btn btn-danger" bindtap="clearStats">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
  </view>
</view>
